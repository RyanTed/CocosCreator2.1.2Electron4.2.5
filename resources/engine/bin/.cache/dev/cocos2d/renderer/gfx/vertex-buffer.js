(function () {
    var nodeEnv = typeof require !== 'undefined' && typeof process !== 'undefined';
    var __module = nodeEnv ? module : { exports: {} };
    var __filename = 'engine-dev/cocos2d/renderer/gfx/vertex-buffer.js';
    var __require = nodeEnv ? function (request) {
        return require(request);
    } : function (request) {
        return __quick_compile__.require(request, __filename);
    };
    function __define(exports, require, module) {
        if (!nodeEnv) {
            __quick_compile__.registerModule(__filename, module);
        }
                'use strict';
        Object.defineProperty(exports, '__esModule', { value: true });
        var _createClass = function () {
            function defineProperties(target, props) {
                for (var i = 0; i < props.length; i++) {
                    var descriptor = props[i];
                    descriptor.enumerable = descriptor.enumerable || false;
                    descriptor.configurable = true;
                    if ('value' in descriptor)
                        descriptor.writable = true;
                    Object.defineProperty(target, descriptor.key, descriptor);
                }
            }
            return function (Constructor, protoProps, staticProps) {
                if (protoProps)
                    defineProperties(Constructor.prototype, protoProps);
                if (staticProps)
                    defineProperties(Constructor, staticProps);
                return Constructor;
            };
        }();
        var _enums = require('./enums');
        function _classCallCheck(instance, Constructor) {
            if (!(instance instanceof Constructor)) {
                throw new TypeError('Cannot call a class as a function');
            }
        }
        var VertexBuffer = function () {
            function VertexBuffer(device, format, usage, data, numVertices) {
                _classCallCheck(this, VertexBuffer);
                this._device = device;
                this._format = format;
                this._usage = usage;
                this._numVertices = numVertices;
                this._bytes = this._format._bytes * numVertices;
                this._glID = device._gl.createBuffer();
                this.update(0, data);
                device._stats.vb += this._bytes;
            }
            _createClass(VertexBuffer, [
                {
                    key: 'destroy',
                    value: function destroy() {
                        if (this._glID === -1) {
                            console.error('The buffer already destroyed');
                            return;
                        }
                        var gl = this._device._gl;
                        gl.deleteBuffer(this._glID);
                        this._device._stats.vb -= this.bytes;
                        this._glID = -1;
                    }
                },
                {
                    key: 'update',
                    value: function update(offset, data) {
                        if (this._glID === -1) {
                            console.error('The buffer is destroyed');
                            return;
                        }
                        if (data && data.byteLength + offset > this._bytes) {
                            console.error('Failed to update data, bytes exceed.');
                            return;
                        }
                        var gl = this._device._gl;
                        var glUsage = this._usage;
                        gl.bindBuffer(gl.ARRAY_BUFFER, this._glID);
                        if (!data) {
                            if (this._bytes) {
                                gl.bufferData(gl.ARRAY_BUFFER, this._bytes, glUsage);
                            } else {
                                console.warn('bufferData should not submit 0 bytes data');
                            }
                        } else {
                            if (offset) {
                                gl.bufferSubData(gl.ARRAY_BUFFER, offset, data);
                            } else {
                                gl.bufferData(gl.ARRAY_BUFFER, data, glUsage);
                            }
                        }
                        gl.bindBuffer(gl.ARRAY_BUFFER, null);
                    }
                },
                {
                    key: 'count',
                    get: function get() {
                        return this._numVertices;
                    }
                }
            ]);
            return VertexBuffer;
        }();
        exports.default = VertexBuffer;
        module.exports = exports['default'];
    }
    if (nodeEnv) {
        __define(__module.exports, __require, __module);
    } else {
        __quick_compile__.registerModuleFunc(__filename, function () {
            __define(__module.exports, __require, __module);
        });
    }
}());
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInZlcnRleC1idWZmZXIuanMiLCJDOi9Vc2Vycy9uYW50YXMvZmlyZWJhbGwteC9mYl8yMS1yZWxlYXNlL2VuZ2luZS9jb2NvczJkL3JlbmRlcmVyL2dmeC92ZXJ0ZXgtYnVmZmVyLmpzIl0sIm5hbWVzIjpbIlZlcnRleEJ1ZmZlciIsImRldmljZSIsImZvcm1hdCIsInVzYWdlIiwiZGF0YSIsIm51bVZlcnRpY2VzIiwiX2RldmljZSIsIl9mb3JtYXQiLCJfdXNhZ2UiLCJfbnVtVmVydGljZXMiLCJfYnl0ZXMiLCJfZ2xJRCIsIl9nbCIsImNyZWF0ZUJ1ZmZlciIsInVwZGF0ZSIsIl9zdGF0cyIsInZiIiwiY29uc29sZSIsImVycm9yIiwiZ2wiLCJkZWxldGVCdWZmZXIiLCJieXRlcyIsIm9mZnNldCIsImJ5dGVMZW5ndGgiLCJnbFVzYWdlIiwiYmluZEJ1ZmZlciIsIkFSUkFZX0JVRkZFUiIsImJ1ZmZlckRhdGEiLCJ3YXJuIiwiYnVmZmVyU3ViRGF0YSJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztRQUFBLE9BQUEsaUJBQUEsQ0FBQSxPQUFBLENBQUEsT0FBQSxFQUFBLFVBQUEsQ0FBQTs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O1FBQUEsSUFBQSxNQUFBLEdBQUEsT0FBQSxDQUFBLFNBQUEsQ0FBQTs7Ozs7O1lBRU1BLFlBQUFBO1lBU0osU0FBQSxZQUFBLENBQVlDLE1BQVosRUFBb0JDLE1BQXBCLEVBQTRCQyxLQUE1QixFQUFtQ0MsSUFBbkMsRUFBeUNDLFdBQXpDLEVBQXNEO0FBQUEsZ0JBQUEsZUFBQSxDQUFBLElBQUEsRUFBQSxZQUFBLEVBQUE7QUFBQSxnQkFDcEQsS0FBS0MsT0FBTCxHQUFlTCxNQUFmLENBRG9EO0FBQUEsZ0JBRXBELEtBQUtNLE9BQUwsR0FBZUwsTUFBZixDQUZvRDtBQUFBLGdCQUdwRCxLQUFLTSxNQUFMLEdBQWNMLEtBQWQsQ0FIb0Q7QUFBQSxnQkFJcEQsS0FBS00sWUFBTCxHQUFvQkosV0FBcEIsQ0FKb0Q7QUFBQSxnQkFP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IiwiZmlsZSI6InZlcnRleC1idWZmZXIuanMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBlbnVtcyB9IGZyb20gJy4vZW51bXMnO1xyXG5cclxuY2xhc3MgVmVydGV4QnVmZmVyIHtcclxuICAvKipcclxuICAgKiBAY29uc3RydWN0b3JcclxuICAgKiBAcGFyYW0ge0RldmljZX0gZGV2aWNlXHJcbiAgICogQHBhcmFtIHtWZXJ0ZXhGb3JtYXR9IGZvcm1hdFxyXG4gICAqIEBwYXJhbSB7VVNBR0VfKn0gdXNhZ2VcclxuICAgKiBAcGFyYW0ge0FycmF5QnVmZmVyIHwgVWludDhBcnJheX0gZGF0YVxyXG4gICAqIEBwYXJhbSB7TnVtYmVyfSBudW1WZXJ0aWNlc1xyXG4gICAqL1xyXG4gIGNvbnN0cnVjdG9yKGRldmljZSwgZm9ybWF0LCB1c2FnZSwgZGF0YSwgbnVtVmVydGljZXMpIHtcclxuICAgIHRoaXMuX2RldmljZSA9IGRldmljZTtcclxuICAgIHRoaXMuX2Zvcm1hdCA9IGZvcm1hdDtcclxuICAgIHRoaXMuX3VzYWdlID0gdXNhZ2U7XHJcbiAgICB0aGlzLl9udW1WZXJ0aWNlcyA9IG51bVZlcnRpY2VzO1xyXG5cclxuICAgIC8vIGNhbGN1bGF0ZSBieXRlc1xyXG4gICAgdGhpcy5fYnl0ZXMgPSB0aGlzLl9mb3JtYXQuX2J5dGVzICogbnVtVmVydGljZXM7XHJcblxyXG4gICAgLy8gdXBkYXRlXHJcbiAgICB0aGlzLl9nbElEID0gZGV2aWNlLl9nbC5jcmVhdGVCdWZmZXIoKTtcclxuICAgIHRoaXMudXBkYXRlKDAsIGRhdGEpO1xyXG5cclxuICAgIC8vIHN0YXRzXHJcbiAgICBkZXZpY2UuX3N0YXRzLnZiICs9IHRoaXMuX2J5dGVzO1xyXG4gIH1cclxuXHJcbiAgLyoqXHJcbiAgICogQG1ldGhvZCBkZXN0cm95XHJcbiAgICovXHJcbiAgZGVzdHJveSgpIHtcclxuICAgIGlmICh0aGlzLl9nbElEID09PSAtMSkge1xyXG4gICAgICBjb25zb2xlLmVycm9yKCdUaGUgYnVmZmVyIGFscmVhZHkgZGVzdHJveWVkJyk7XHJcbiAgICAgIHJldHVybjtcclxuICAgIH1cclxuXHJcbiAgICBsZXQgZ2wgPSB0aGlzLl9kZXZpY2UuX2dsO1xyXG4gICAgZ2wuZGVsZXRlQnVmZmVyKHRoaXMuX2dsSUQpO1xyXG4gICAgdGhpcy5fZGV2aWNlLl9zdGF0cy52YiAtPSB0aGlzLmJ5dGVzO1xyXG5cclxuICAgIHRoaXMuX2dsSUQgPSAtMTtcclxuICB9XHJcblxyXG4gIC8qKlxyXG4gICAqIEBtZXRob2QgdXBkYXRlXHJcbiAgICogQHBhcmFtIHtOdW1iZXJ9IG9mZnNldFxyXG4gICAqIEBwYXJhbSB7QXJyYXlCdWZmZXJ9IGRhdGFcclxuICAgKi9cclxuICB1cGRhdGUob2Zmc2V0LCBkYXRhKSB7XHJcbiAgICBpZiAodGhpcy5fZ2xJRCA9PT0gLTEpIHtcclxuICAgICAgY29uc29sZS5lcnJvcignVGhlIGJ1ZmZlciBpcyBkZXN0cm95ZWQnKTtcclxuICAgICAgcmV0dXJuO1xyXG4gICAgfVxyXG5cclxuICAgIGlmIChkYXRhICYmIGRhdGEuYnl0ZUxlbmd0aCArIG9mZnNldCA+IHRoaXMuX2J5dGVzKSB7XHJcbiAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZhaWxlZCB0byB1cGRhdGUgZGF0YSwgYnl0ZXMgZXhjZWVkLicpO1xyXG4gICAgICByZXR1cm47XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IGdsID0gdGhpcy5fZGV2aWNlLl9nbDtcclxuICAgIGxldCBnbFVzYWdlID0gdGhpcy5fdXNhZ2U7XHJcblxyXG4gICAgZ2wuYmluZEJ1ZmZlcihnbC5BUlJBWV9CVUZGRVIsIHRoaXMuX2dsSUQpO1xyXG4gICAgaWYgKCFkYXRhKSB7XHJcbiAgICAgIGlmICh0aGlzLl9ieXRlcykge1xyXG4gICAgICAgIGdsLmJ1ZmZlckRhdGEoZ2wuQVJSQVlfQlVGRkVSLCB0aGlzLl9ieXRlcywgZ2xVc2FnZSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgY29uc29sZS53YXJuKCdidWZmZXJEYXRhIHNob3VsZCBub3Qgc3VibWl0IDAgYnl0ZXMgZGF0YScpO1xyXG4gICAgICB9XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICBpZiAob2Zmc2V0KSB7XHJcbiAgICAgICAgZ2wuYnVmZmVyU3ViRGF0YShnbC5BUlJBWV9CVUZGRVIsIG9mZnNldCwgZGF0YSk7XHJcbiAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgZ2wuYnVmZmVyRGF0YShnbC5BUlJBWV9CVUZGRVIsIGRhdGEsIGdsVXNhZ2UpO1xyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgICBnbC5iaW5kQnVmZmVyKGdsLkFSUkFZX0JVRkZFUiwgbnVsbCk7XHJcbiAgfVxyXG5cclxuICBnZXQgY291bnQgKCkge1xyXG4gICAgcmV0dXJuIHRoaXMuX251bVZlcnRpY2VzO1xyXG4gIH1cclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgVmVydGV4QnVmZmVyO1xyXG4iLCIndXNlIHN0cmljdCc7XG5cbk9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBcIl9fZXNNb2R1bGVcIiwge1xuICB2YWx1ZTogdHJ1ZVxufSk7XG5cbnZhciBfY3JlYXRlQ2xhc3MgPSBmdW5jdGlvbiAoKSB7IGZ1bmN0aW9uIGRlZmluZVByb3BlcnRpZXModGFyZ2V0LCBwcm9wcykgeyBmb3IgKHZhciBpID0gMDsgaSA8IHByb3BzLmxlbmd0aDsgaSsrKSB7IHZhciBkZXNjcmlwdG9yID0gcHJvcHNbaV07IGRlc2NyaXB0b3IuZW51bWVyYWJsZSA9IGRlc2NyaXB0b3IuZW51bWVyYWJsZSB8fCBmYWxzZTsgZGVzY3JpcHRvci5jb25maWd1cmFibGUgPSB0cnVlOyBpZiAoXCJ2YWx1ZVwiIGluIGRlc2NyaXB0b3IpIGRlc2NyaXB0b3Iud3JpdGFibGUgPSB0cnVlOyBPYmplY3QuZGVmaW5lUHJvcGVydHkodGFyZ2V0LCBkZXNjcmlwdG9yLmtleSwgZGVzY3JpcHRvcik7IH0gfSByZXR1cm4gZnVuY3Rpb24gKENvbnN0cnVjdG9yLCBwcm90b1Byb3BzLCBzdGF0aWNQcm9wcykgeyBpZiAocHJvdG9Qcm9wcykgZGVmaW5lUHJvcGVydGllcyhDb25zdHJ1Y3Rvci5wcm90b3R5cGUsIHByb3RvUHJvcHMpOyBpZiAoc3RhdGljUHJvcHMpIGRlZmluZVByb3BlcnRpZXMoQ29uc3RydWN0b3IsIHN0YXRpY1Byb3BzKTsgcmV0dXJuIENvbnN0cnVjdG9yOyB9OyB9KCk7XG5cbnZhciBfZW51bXMgPSByZXF1aXJlKCcuL2VudW1zJyk7XG5cbmZ1bmN0aW9uIF9jbGFzc0NhbGxDaGVjayhpbnN0YW5jZSwgQ29uc3RydWN0b3IpIHsgaWYgKCEoaW5zdGFuY2UgaW5zdGFuY2VvZiBDb25zdHJ1Y3RvcikpIHsgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkNhbm5vdCBjYWxsIGEgY2xhc3MgYXMgYSBmdW5jdGlvblwiKTsgfSB9XG5cbnZhciBWZXJ0ZXhCdWZmZXIgPSBmdW5jdGlvbiAoKSB7XG4gIC8qKlxyXG4gICAqIEBjb25zdHJ1Y3RvclxyXG4gICAqIEBwYXJhbSB7RGV2aWNlfSBkZXZpY2VcclxuICAgKiBAcGFyYW0ge1ZlcnRleEZvcm1hdH0gZm9ybWF0XHJcbiAgICogQHBhcmFtIHtVU0FHRV8qfSB1c2FnZVxyXG4gICAqIEBwYXJhbSB7QXJyYXlCdWZmZXIgfCBVaW50OEFycmF5fSBkYXRhXHJcbiAgICogQHBhcmFtIHtOdW1iZXJ9IG51bVZlcnRpY2VzXHJcbiAgICovXG4gIGZ1bmN0aW9uIFZlcnRleEJ1ZmZlcihkZXZpY2UsIGZvcm1hdCwgdXNhZ2UsIGRhdGEsIG51bVZlcnRpY2VzKSB7XG4gICAgX2NsYXNzQ2FsbENoZWNrKHRoaXMsIFZlcnRleEJ1ZmZlcik7XG5cbiAgICB0aGlzLl9kZXZpY2UgPSBkZXZpY2U7XG4gICAgdGhpcy5fZm9ybWF0ID0gZm9ybWF0O1xuICAgIHRoaXMuX3VzYWdlID0gdXNhZ2U7XG4gICAgdGhpcy5fbnVtVmVydGljZXMgPSBudW1WZXJ0aWNlcztcblxuICAgIC8vIGNhbGN1bGF0ZSBieXRlc1xuICAgIHRoaXMuX2J5dGVzID0gdGhpcy5fZm9ybWF0Ll9ieXRlcyAqIG51bVZlcnRpY2VzO1xuXG4gICAgLy8gdXBkYXRlXG4gICAgdGhpcy5fZ2xJRCA9IGRldmljZS5fZ2wuY3JlYXRlQnVmZmVyKCk7XG4gICAgdGhpcy51cGRhdGUoMCwgZGF0YSk7XG5cbiAgICAvLyBzdGF0c1xuICAgIGRldmljZS5fc3RhdHMudmIgKz0gdGhpcy5fYnl0ZXM7XG4gIH1cblxuICAvKipcclxuICAgKiBAbWV0aG9kIGRlc3Ryb3lcclxuICAgKi9cblxuXG4gIF9jcmVhdGVDbGFzcyhWZXJ0ZXhCdWZmZXIsIFt7XG4gICAga2V5OiAnZGVzdHJveScsXG4gICAgdmFsdWU6IGZ1bmN0aW9uIGRlc3Ryb3koKSB7XG4gICAgICBpZiAodGhpcy5fZ2xJRCA9PT0gLTEpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignVGhlIGJ1ZmZlciBhbHJlYWR5IGRlc3Ryb3llZCcpO1xuICAgICAgICByZXR1cm47XG4gICAgICB9XG5cbiAgICAgIHZhciBnbCA9IHRoaXMuX2RldmljZS5fZ2w7XG4gICAgICBnbC5kZWxldGVCdWZmZXIodGhpcy5fZ2xJRCk7XG4gICAgICB0aGlzLl9kZXZpY2UuX3N0YXRzLnZiIC09IHRoaXMuYnl0ZXM7XG5cbiAgICAgIHRoaXMuX2dsSUQgPSAtMTtcbiAgICB9XG5cbiAgICAvKipcclxuICAgICAqIEBtZXRob2QgdXBkYXRlXHJcbiAgICAgKiBAcGFyYW0ge051bWJlcn0gb2Zmc2V0XHJcbiAgICAgKiBAcGFyYW0ge0FycmF5QnVmZmVyfSBkYXRhXHJcbiAgICAgKi9cblxuICB9LCB7XG4gICAga2V5OiAndXBkYXRlJyxcbiAgICB2YWx1ZTogZnVuY3Rpb24gdXBkYXRlKG9mZnNldCwgZGF0YSkge1xuICAgICAgaWYgKHRoaXMuX2dsSUQgPT09IC0xKSB7XG4gICAgICAgIGNvbnNvbGUuZXJyb3IoJ1RoZSBidWZmZXIgaXMgZGVzdHJveWVkJyk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgaWYgKGRhdGEgJiYgZGF0YS5ieXRlTGVuZ3RoICsgb2Zmc2V0ID4gdGhpcy5fYnl0ZXMpIHtcbiAgICAgICAgY29uc29sZS5lcnJvcignRmFpbGVkIHRvIHVwZGF0ZSBkYXRhLCBieXRlcyBleGNlZWQuJyk7XG4gICAgICAgIHJldHVybjtcbiAgICAgIH1cblxuICAgICAgdmFyIGdsID0gdGhpcy5fZGV2aWNlLl9nbDtcbiAgICAgIHZhciBnbFVzYWdlID0gdGhpcy5fdXNhZ2U7XG5cbiAgICAgIGdsLmJpbmRCdWZmZXIoZ2wuQVJSQVlfQlVGRkVSLCB0aGlzLl9nbElEKTtcbiAgICAgIGlmICghZGF0YSkge1xuICAgICAgICBpZiAodGhpcy5fYnl0ZXMpIHtcbiAgICAgICAgICBnbC5idWZmZXJEYXRhKGdsLkFSUkFZX0JVRkZFUiwgdGhpcy5fYnl0ZXMsIGdsVXNhZ2UpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGNvbnNvbGUud2FybignYnVmZmVyRGF0YSBzaG91bGQgbm90IHN1Ym1pdCAwIGJ5dGVzIGRhdGEnKTtcbiAgICAgICAgfVxuICAgICAgfSBlbHNlIHtcbiAgICAgICAgaWYgKG9mZnNldCkge1xuICAgICAgICAgIGdsLmJ1ZmZlclN1YkRhdGEoZ2wuQVJSQVlfQlVGRkVSLCBvZmZzZXQsIGRhdGEpO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIGdsLmJ1ZmZlckRhdGEoZ2wuQVJSQVlfQlVGRkVSLCBkYXRhLCBnbFVzYWdlKTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgZ2wuYmluZEJ1ZmZlcihnbC5BUlJBWV9CVUZGRVIsIG51bGwpO1xuICAgIH1cbiAgfSwge1xuICAgIGtleTogJ2NvdW50JyxcbiAgICBnZXQ6IGZ1bmN0aW9uIGdldCgpIHtcbiAgICAgIHJldHVybiB0aGlzLl9udW1WZXJ0aWNlcztcbiAgICB9XG4gIH1dKTtcblxuICByZXR1cm4gVmVydGV4QnVmZmVyO1xufSgpO1xuXG5leHBvcnRzLmRlZmF1bHQgPSBWZXJ0ZXhCdWZmZXI7XG5tb2R1bGUuZXhwb3J0cyA9IGV4cG9ydHNbJ2RlZmF1bHQnXTtcbi8vIyBzb3VyY2VNYXBwaW5nVVJMPWRhdGE6YXBwbGljYXRpb24vanNvbjtjaGFyc2V0PXV0Zi04O2Jhc2U2NCxleUoyWlhKemFXOXVJam96TENKemIzVnlZMlZ6SWpwYkluWmxjblJsZUMxaWRXWm1aWEl1YW5NaVhTd2libUZ0WlhNaU9sc2lWbVZ5ZEdWNFFuVm1abVZ5SWl3aVpHVjJhV05sSWl3aVptOXliV0YwSWl3aWRYTmhaMlVpTENKa1lYUmhJaXdpYm5WdFZtVnlkR2xqWlhNaUxDSmZaR1YyYVdObElpd2lYMlp2Y20xaGRDSXNJbDkxYzJGblpTSXNJbDl1ZFcxV1pYSjBhV05sY3lJc0lsOWllWFJsY3lJc0lsOW5iRWxFSWl3aVgyZHNJaXdpWTNKbFlYUmxRblZtWm1WeUlpd2lkWEJrWVhSbElpd2lYM04wWVhSeklpd2lkbUlpTENKamIyNXpiMnhsSWl3aVpYSnliM0lpTENKbmJDSXNJbVJsYkdWMFpVSjFabVpsY2lJc0ltSjVkR1Z6SWl3aWIyWm1jMlYwSWl3aVlubDBaVXhsYm1kMGFDSXNJbWRzVlhOaFoyVWlMQ0ppYVc1a1FuVm1abVZ5SWl3aVFWSlNRVmxmUWxWR1JrVlNJaXdpWW5WbVptVnlSR0YwWVNJc0luZGhjbTRpTENKaWRXWm1aWEpUZFdKRVlYUmhJbDBzSW0xaGNIQnBibWR6SWpvaU96czdPenM3T3p0QlFVRkJPenM3TzBsQlJVMUJMRms3UVVGRFNqczdPenM3T3pzN1FVRlJRU3gzUWtGQldVTXNUVUZCV2l4RlFVRnZRa01zVFVGQmNFSXNSVUZCTkVKRExFdEJRVFZDTEVWQlFXMURReXhKUVVGdVF5eEZRVUY1UTBNc1YwRkJla01zUlVGQmMwUTdRVUZCUVRzN1FVRkRjRVFzVTBGQlMwTXNUMEZCVEN4SFFVRmxUQ3hOUVVGbU8wRkJRMEVzVTBGQlMwMHNUMEZCVEN4SFFVRmxUQ3hOUVVGbU8wRkJRMEVzVTBGQlMwMHNUVUZCVEN4SFFVRmpUQ3hMUVVGa08wRkJRMEVzVTBGQlMwMHNXVUZCVEN4SFFVRnZRa29zVjBGQmNFSTdPMEZCUlVFN1FVRkRRU3hUUVVGTFN5eE5RVUZNTEVkQlFXTXNTMEZCUzBnc1QwRkJUQ3hEUVVGaFJ5eE5RVUZpTEVkQlFYTkNUQ3hYUVVGd1F6czdRVUZGUVR0QlFVTkJMRk5CUVV0TkxFdEJRVXdzUjBGQllWWXNUMEZCVDFjc1IwRkJVQ3hEUVVGWFF5eFpRVUZZTEVWQlFXSTdRVUZEUVN4VFFVRkxReXhOUVVGTUxFTkJRVmtzUTBGQldpeEZRVUZsVml4SlFVRm1PenRCUVVWQk8wRkJRMEZJTEZkQlFVOWpMRTFCUVZBc1EwRkJZME1zUlVGQlpDeEpRVUZ2UWl4TFFVRkxUaXhOUVVGNlFqdEJRVU5FT3p0QlFVVkVPenM3T3pzN096aENRVWRWTzBGQlExSXNWVUZCU1N4TFFVRkxReXhMUVVGTUxFdEJRV1VzUTBGQlF5eERRVUZ3UWl4RlFVRjFRanRCUVVOeVFrMHNaMEpCUVZGRExFdEJRVklzUTBGQll5dzRRa0ZCWkR0QlFVTkJPMEZCUTBRN08wRkJSVVFzVlVGQlNVTXNTMEZCU3l4TFFVRkxZaXhQUVVGTUxFTkJRV0ZOTEVkQlFYUkNPMEZCUTBGUExGTkJRVWRETEZsQlFVZ3NRMEZCWjBJc1MwRkJTMVFzUzBGQmNrSTdRVUZEUVN4WFFVRkxUQ3hQUVVGTUxFTkJRV0ZUTEUxQlFXSXNRMEZCYjBKRExFVkJRWEJDTEVsQlFUQkNMRXRCUVV0TExFdEJRUzlDT3p0QlFVVkJMRmRCUVV0V0xFdEJRVXdzUjBGQllTeERRVUZETEVOQlFXUTdRVUZEUkRzN1FVRkZSRHM3T3pzN096czdNa0pCUzA5WExFMHNSVUZCVVd4Q0xFa3NSVUZCVFR0QlFVTnVRaXhWUVVGSkxFdEJRVXRQTEV0QlFVd3NTMEZCWlN4RFFVRkRMRU5CUVhCQ0xFVkJRWFZDTzBGQlEzSkNUU3huUWtGQlVVTXNTMEZCVWl4RFFVRmpMSGxDUVVGa08wRkJRMEU3UVVGRFJEczdRVUZGUkN4VlFVRkpaQ3hSUVVGUlFTeExRVUZMYlVJc1ZVRkJUQ3hIUVVGclFrUXNUVUZCYkVJc1IwRkJNa0lzUzBGQlMxb3NUVUZCTlVNc1JVRkJiMFE3UVVGRGJFUlBMR2RDUVVGUlF5eExRVUZTTEVOQlFXTXNjME5CUVdRN1FVRkRRVHRCUVVORU96dEJRVVZFTEZWQlFVbERMRXRCUVVzc1MwRkJTMklzVDBGQlRDeERRVUZoVFN4SFFVRjBRanRCUVVOQkxGVkJRVWxaTEZWQlFWVXNTMEZCUzJoQ0xFMUJRVzVDT3p0QlFVVkJWeXhUUVVGSFRTeFZRVUZJTEVOQlFXTk9MRWRCUVVkUExGbEJRV3BDTEVWQlFTdENMRXRCUVV0bUxFdEJRWEJETzBGQlEwRXNWVUZCU1N4RFFVRkRVQ3hKUVVGTUxFVkJRVmM3UVVGRFZDeFpRVUZKTEV0QlFVdE5MRTFCUVZRc1JVRkJhVUk3UVVGRFpsTXNZVUZCUjFFc1ZVRkJTQ3hEUVVGalVpeEhRVUZIVHl4WlFVRnFRaXhGUVVFclFpeExRVUZMYUVJc1RVRkJjRU1zUlVGQk5FTmpMRTlCUVRWRE8wRkJRMFFzVTBGR1JDeE5RVVZQTzBGQlEweFFMR3RDUVVGUlZ5eEpRVUZTTEVOQlFXRXNNa05CUVdJN1FVRkRSRHRCUVVOR0xFOUJUa1FzVFVGTlR6dEJRVU5NTEZsQlFVbE9MRTFCUVVvc1JVRkJXVHRCUVVOV1NDeGhRVUZIVlN4aFFVRklMRU5CUVdsQ1ZpeEhRVUZIVHl4WlFVRndRaXhGUVVGclEwb3NUVUZCYkVNc1JVRkJNRU5zUWl4SlFVRXhRenRCUVVORUxGTkJSa1FzVFVGRlR6dEJRVU5NWlN4aFFVRkhVU3hWUVVGSUxFTkJRV05TTEVkQlFVZFBMRmxCUVdwQ0xFVkJRU3RDZEVJc1NVRkJMMElzUlVGQmNVTnZRaXhQUVVGeVF6dEJRVU5FTzBGQlEwWTdRVUZEUkV3c1UwRkJSMDBzVlVGQlNDeERRVUZqVGl4SFFVRkhUeXhaUVVGcVFpeEZRVUVyUWl4SlFVRXZRanRCUVVORU96czdkMEpCUlZrN1FVRkRXQ3hoUVVGUExFdEJRVXRxUWl4WlFVRmFPMEZCUTBRN096czdPenRyUWtGSFdWUXNXU0lzSW1acGJHVWlPaUoyWlhKMFpYZ3RZblZtWm1WeUxtcHpJaXdpYzI5MWNtTmxjME52Ym5SbGJuUWlPbHNpYVcxd2IzSjBJSHNnWlc1MWJYTWdmU0JtY205dElDY3VMMlZ1ZFcxekp6dGNjbHh1WEhKY2JtTnNZWE56SUZabGNuUmxlRUoxWm1abGNpQjdYSEpjYmlBZ0x5b3FYSEpjYmlBZ0lDb2dRR052Ym5OMGNuVmpkRzl5WEhKY2JpQWdJQ29nUUhCaGNtRnRJSHRFWlhacFkyVjlJR1JsZG1salpWeHlYRzRnSUNBcUlFQndZWEpoYlNCN1ZtVnlkR1Y0Um05eWJXRjBmU0JtYjNKdFlYUmNjbHh1SUNBZ0tpQkFjR0Z5WVcwZ2UxVlRRVWRGWHlwOUlIVnpZV2RsWEhKY2JpQWdJQ29nUUhCaGNtRnRJSHRCY25KaGVVSjFabVpsY2lCOElGVnBiblE0UVhKeVlYbDlJR1JoZEdGY2NseHVJQ0FnS2lCQWNHRnlZVzBnZTA1MWJXSmxjbjBnYm5WdFZtVnlkR2xqWlhOY2NseHVJQ0FnS2k5Y2NseHVJQ0JqYjI1emRISjFZM1J2Y2loa1pYWnBZMlVzSUdadmNtMWhkQ3dnZFhOaFoyVXNJR1JoZEdFc0lHNTFiVlpsY25ScFkyVnpLU0I3WEhKY2JpQWdJQ0IwYUdsekxsOWtaWFpwWTJVZ1BTQmtaWFpwWTJVN1hISmNiaUFnSUNCMGFHbHpMbDltYjNKdFlYUWdQU0JtYjNKdFlYUTdYSEpjYmlBZ0lDQjBhR2x6TGw5MWMyRm5aU0E5SUhWellXZGxPMXh5WEc0Z0lDQWdkR2hwY3k1ZmJuVnRWbVZ5ZEdsalpYTWdQU0J1ZFcxV1pYSjBhV05sY3p0Y2NseHVYSEpjYmlBZ0lDQXZMeUJqWVd4amRXeGhkR1VnWW5sMFpYTmNjbHh1SUNBZ0lIUm9hWE11WDJKNWRHVnpJRDBnZEdocGN5NWZabTl5YldGMExsOWllWFJsY3lBcUlHNTFiVlpsY25ScFkyVnpPMXh5WEc1Y2NseHVJQ0FnSUM4dklIVndaR0YwWlZ4eVhHNGdJQ0FnZEdocGN5NWZaMnhKUkNBOUlHUmxkbWxqWlM1Zloyd3VZM0psWVhSbFFuVm1abVZ5S0NrN1hISmNiaUFnSUNCMGFHbHpMblZ3WkdGMFpTZ3dMQ0JrWVhSaEtUdGNjbHh1WEhKY2JpQWdJQ0F2THlCemRHRjBjMXh5WEc0Z0lDQWdaR1YyYVdObExsOXpkR0YwY3k1MllpQXJQU0IwYUdsekxsOWllWFJsY3p0Y2NseHVJQ0I5WEhKY2JseHlYRzRnSUM4cUtseHlYRzRnSUNBcUlFQnRaWFJvYjJRZ1pHVnpkSEp2ZVZ4eVhHNGdJQ0FxTDF4eVhHNGdJR1JsYzNSeWIza29LU0I3WEhKY2JpQWdJQ0JwWmlBb2RHaHBjeTVmWjJ4SlJDQTlQVDBnTFRFcElIdGNjbHh1SUNBZ0lDQWdZMjl1YzI5c1pTNWxjbkp2Y2lnblZHaGxJR0oxWm1abGNpQmhiSEpsWVdSNUlHUmxjM1J5YjNsbFpDY3BPMXh5WEc0Z0lDQWdJQ0J5WlhSMWNtNDdYSEpjYmlBZ0lDQjlYSEpjYmx4eVhHNGdJQ0FnYkdWMElHZHNJRDBnZEdocGN5NWZaR1YyYVdObExsOW5iRHRjY2x4dUlDQWdJR2RzTG1SbGJHVjBaVUoxWm1abGNpaDBhR2x6TGw5bmJFbEVLVHRjY2x4dUlDQWdJSFJvYVhNdVgyUmxkbWxqWlM1ZmMzUmhkSE11ZG1JZ0xUMGdkR2hwY3k1aWVYUmxjenRjY2x4dVhISmNiaUFnSUNCMGFHbHpMbDluYkVsRUlEMGdMVEU3WEhKY2JpQWdmVnh5WEc1Y2NseHVJQ0F2S2lwY2NseHVJQ0FnS2lCQWJXVjBhRzlrSUhWd1pHRjBaVnh5WEc0Z0lDQXFJRUJ3WVhKaGJTQjdUblZ0WW1WeWZTQnZabVp6WlhSY2NseHVJQ0FnS2lCQWNHRnlZVzBnZTBGeWNtRjVRblZtWm1WeWZTQmtZWFJoWEhKY2JpQWdJQ292WEhKY2JpQWdkWEJrWVhSbEtHOW1abk5sZEN3Z1pHRjBZU2tnZTF4eVhHNGdJQ0FnYVdZZ0tIUm9hWE11WDJkc1NVUWdQVDA5SUMweEtTQjdYSEpjYmlBZ0lDQWdJR052Ym5OdmJHVXVaWEp5YjNJb0oxUm9aU0JpZFdabVpYSWdhWE1nWkdWemRISnZlV1ZrSnlrN1hISmNiaUFnSUNBZ0lISmxkSFZ5Ymp0Y2NseHVJQ0FnSUgxY2NseHVYSEpjYmlBZ0lDQnBaaUFvWkdGMFlTQW1KaUJrWVhSaExtSjVkR1ZNWlc1bmRHZ2dLeUJ2Wm1aelpYUWdQaUIwYUdsekxsOWllWFJsY3lrZ2UxeHlYRzRnSUNBZ0lDQmpiMjV6YjJ4bExtVnljbTl5S0NkR1lXbHNaV1FnZEc4Z2RYQmtZWFJsSUdSaGRHRXNJR0o1ZEdWeklHVjRZMlZsWkM0bktUdGNjbHh1SUNBZ0lDQWdjbVYwZFhKdU8xeHlYRzRnSUNBZ2ZWeHlYRzVjY2x4dUlDQWdJR3hsZENCbmJDQTlJSFJvYVhNdVgyUmxkbWxqWlM1ZloydzdYSEpjYmlBZ0lDQnNaWFFnWjJ4VmMyRm5aU0E5SUhSb2FYTXVYM1Z6WVdkbE8xeHlYRzVjY2x4dUlDQWdJR2RzTG1KcGJtUkNkV1ptWlhJb1oyd3VRVkpTUVZsZlFsVkdSa1ZTTENCMGFHbHpMbDluYkVsRUtUdGNjbHh1SUNBZ0lHbG1JQ2doWkdGMFlTa2dlMXh5WEc0Z0lDQWdJQ0JwWmlBb2RHaHBjeTVmWW5sMFpYTXBJSHRjY2x4dUlDQWdJQ0FnSUNCbmJDNWlkV1ptWlhKRVlYUmhLR2RzTGtGU1VrRlpYMEpWUmtaRlVpd2dkR2hwY3k1ZllubDBaWE1zSUdkc1ZYTmhaMlVwTzF4eVhHNGdJQ0FnSUNCOUlHVnNjMlVnZTF4eVhHNGdJQ0FnSUNBZ0lHTnZibk52YkdVdWQyRnliaWduWW5WbVptVnlSR0YwWVNCemFHOTFiR1FnYm05MElITjFZbTFwZENBd0lHSjVkR1Z6SUdSaGRHRW5LVHRjY2x4dUlDQWdJQ0FnZlZ4eVhHNGdJQ0FnZlNCbGJITmxJSHRjY2x4dUlDQWdJQ0FnYVdZZ0tHOW1abk5sZENrZ2UxeHlYRzRnSUNBZ0lDQWdJR2RzTG1KMVptWmxjbE4xWWtSaGRHRW9aMnd1UVZKU1FWbGZRbFZHUmtWU0xDQnZabVp6WlhRc0lHUmhkR0VwTzF4eVhHNGdJQ0FnSUNCOUlHVnNjMlVnZTF4eVhHNGdJQ0FnSUNBZ0lHZHNMbUoxWm1abGNrUmhkR0VvWjJ3dVFWSlNRVmxmUWxWR1JrVlNMQ0JrWVhSaExDQm5iRlZ6WVdkbEtUdGNjbHh1SUNBZ0lDQWdmVnh5WEc0Z0lDQWdmVnh5WEc0Z0lDQWdaMnd1WW1sdVpFSjFabVpsY2lobmJDNUJVbEpCV1Y5Q1ZVWkdSVklzSUc1MWJHd3BPMXh5WEc0Z0lIMWNjbHh1WEhKY2JpQWdaMlYwSUdOdmRXNTBJQ2dwSUh0Y2NseHVJQ0FnSUhKbGRIVnliaUIwYUdsekxsOXVkVzFXWlhKMGFXTmxjenRjY2x4dUlDQjlYSEpjYm4xY2NseHVYSEpjYm1WNGNHOXlkQ0JrWldaaGRXeDBJRlpsY25SbGVFSjFabVpsY2p0Y2NseHVJbDE5Il19