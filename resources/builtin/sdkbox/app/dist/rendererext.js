!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("os"),require("path"),require("fs"),require("assert"),require("child_process"),require("electron"),require("process"),require("url"));else if("function"==typeof define&&define.amd)define(["os","path","fs","assert","child_process","electron","process","url"],t);else{var n="object"==typeof exports?t(require("os"),require("path"),require("fs"),require("assert"),require("child_process"),require("electron"),require("process"),require("url")):t(e.os,e.path,e.fs,e.assert,e.child_process,e.electron,e.process,e.url);for(var o in n)("object"==typeof exports?exports:e)[o]=n[o]}}(this,function(t,n,o,i,a,r,s,l){return function(e){function t(o){if(n[o])return n[o].exports;var i=n[o]={exports:{},id:o,loaded:!1};return e[o].call(i.exports,i,i.exports,t),i.loaded=!0,i.exports}var n={};return t.m=e,t.c=n,t.p="",t(0)}({0:function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}var i=n(117),a=(o(i),n(124)),r=o(a),s=n(125),l=o(s),c=n(1),u=void 0,d=n(116),h=d.shell,f=(d.ipcRenderer,n(135)),p=function(e){var t=f.parse(e).protocol;return("http:"===t||"https:"===t)&&(h.openExternal(e),!0)};$(document).ready(function(){document.title=document.title+" ("+c.Config.version+(c.Config.beta?" Beta":"")+")";var e=document.querySelectorAll('link[rel="import"]'),t=$("#contents");$(e).each(function(e,n){var o=n.import.querySelector(".tab-template"),i=document.importNode(o.content,!0);t.append(i)}),$("webview").each(function(e,t){t.addEventListener("did-finish-load",function(t){console.log(e,t)}),t.addEventListener("will-navigate",function(e){p(e.url)&&t.stop()})}),r.default.select_tab("cocos"),$("button").on("click",function(e){e.target.blur()}),u=new l.default,$("#tabbar").hide(),$("#contents").css("top","77px")}),$(document).on("click",'a[href^="http"]',function(e){p(e.target.href)&&e.preventDefault()})},1:function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var n={version:"1.3.4",beta:!1};t.Config=n},3:function(e,t){e.exports=require("os")},4:function(e,t){e.exports=require("path")},5:function(e,t){e.exports=require("fs")},17:function(e,t){e.exports=require("assert")},87:function(e,t,n){function o(e,t,n,s){"function"==typeof t?(n=t,t={}):t&&"object"==typeof t||(t={mode:t});var l=t.mode,c=t.fs||a;void 0===l&&(l=r&~process.umask()),s||(s=null);var u=n||function(){};e=i.resolve(e),c.mkdir(e,l,function(n){if(!n)return s=s||e,u(null,s);switch(n.code){case"ENOENT":o(i.dirname(e),t,function(n,i){n?u(n,i):o(e,t,u,i)});break;default:c.stat(e,function(e,t){e||!t.isDirectory()?u(n,s):u(null,s)})}})}var i=n(4),a=n(5),r=parseInt("0777",8);e.exports=o.mkdirp=o.mkdirP=o,o.sync=function e(t,n,o){n&&"object"==typeof n||(n={mode:n});var s=n.mode,l=n.fs||a;void 0===s&&(s=r&~process.umask()),o||(o=null),t=i.resolve(t);try{l.mkdirSync(t,s),o=o||t}catch(a){switch(a.code){case"ENOENT":o=e(i.dirname(t),n,o),e(t,n,o);break;default:var c;try{c=l.statSync(t)}catch(e){throw a}if(!c.isDirectory())throw a}}return o}},114:function(e,t){e.exports=require("child_process")},116:function(e,t){e.exports=require("electron")},117:function(t,n,o){"use strict";function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=o(4),s=o(118),l=o(121),c=o(120),u=void 0,d={adcolony:"AD UNITS",admob:"AD UNITS",agecheq:"MORE",amazon:"APP STORES",appnext:"AD UNITS",appodeal:"AD UNITS",apteligent:"ANALYTICS",bee7:"AD UNITS",chartboost:"AD UNITS",facebook:"SOCIAL",flurryanalytics:"ANALYTICS",fyber:"AD UNITS",googleanalytics:"ANALYTICS",gpg:"ESSENTIALS",iap:"ESSENTIALS",inmobi:"AD UNITS",kochava:"ATTRIBUTION",leadbolt:"AD UNITS",onesignal:"PUSH NOTIFICATION",playphone:"APP STORES",review:"ESSENTIALS",sdkboxads:"ESSENTIALS",sdkboxplay:"ESSENTIALS",share:"ESSENTIALS",scientificrevenue:"IAP OPTIMIZATION",tune:"ATTRIBUTION",valuepotion:"IAP OPTIMIZATION",vungle:"AD UNITS",youtube:"MORE"},h={adcolony:"Instant-play™ HD the best user experience, hands down.",agecheq:"Easy compliance with the US and Euro Child Privacy Laws",appodeal:"Maximize your app revenue efficiently with programmatic ad mediation for publishers.",bee7:"Our Native rewarded re-engagement system encourages valuable players to stay in your game.",chartboost:"The largest mobile games-only platform to increase revenue and discover new players.",facebook:"The world's largest social media network.",flurryanalytics:"Adopt the industry standard, for free.",googleanalytics:"Turn insights into action.",iap:"Implement Cross-Platform IAP easily. Support Apple AppStore, Google Play, Amazon AppStore, and Playphone store.",inmobi:"The Discovery Platform for a Mobile-First World.",kochava:"Driving Effective Mobile Ad Spend",leadbolt:"The high-performance mobile advertising platform for user acquisition and app monetization.",review:"More downloads of your app with App store ratings and reviews.",tune:"Making mobile marketing better, for everyone.",valuepotion:"Monetize your full user base and get your values up!",vungle:"Infrastructure for app monetization through video ads.",youtube:"Single API to play YouTube videos on both iOS and Android.",fyber:"Designed with you in mind, Fyber empowers developers to execute smart ad monetization strategies.",playphone:"Your new, must-have game monetization channel in the world’s fastest growing gaming markets.",scientificrevenue:"Pricing without Compromise.",admob:"Monetize your apps intelligently",amazon:"The exclusive appstore on Kindle tablets, but available for other devices, too.",appnext:"Grow Your Mobile Business by Promoting Apps.",sdkboxplay:"Cross platform support for both Apple Game Center and Google Play Services, including Login, Achievement and Leaderboard.",gpg:"The most secure and reliable game services for your mobile games now available on both Android and iOS!",onesignal:"OneSignal is a free high volume Push Notification service.",apteligent:"Build Better Apps Faster: crash reporting and realtime performance data.",sdkboxads:"An easy-to-use package that includes all SDKBOX supported Ad Units.",share:"Grow audience network by publishing social messages to Facebook and Twitter."};t.exports=function(){function t(){i(this,t),this.manifestJson=null,this.changeServer("production"),this.sdkbox_path=l.getSdkboxBinPath(),this.projects={},this.observerTagPrefix="ObserverTag-",this.observerTagCounter=1,this.projs=null}return a(t,null,[{key:"getInstance",value:function(){return u||(u=new t),u}}]),a(t,[{key:"changeServer",value:function(e){var t=null;t="staging"==e?"http://staging.sdkbox.com/installer/v1/":"http://download.sdkbox.com/installer/v1/",t!=this.serverUrl&&(this.serverUrl=t,this.manifestJson=null)}},{key:"isStaging",value:function(){return-1!=this.serverUrl.indexOf("staging")}},{key:"getDownloadPath",value:function(e,t){if(null==this.manifestJson)return null;e=e.toLowerCase();try{var n=this.manifestJson.packages[e].versions,o=null;for(var i in n){o=n[i][t],o=$.extend({},o);break}return null==o?null:(o.bundle=this.serverUrl+o.bundle,o)}catch(e){return null}}},{key:"getDisplayName",value:function(e){if(null==this.manifestJson)return null;var t=e;try{t=this.manifestJson.packages[e].display_name}catch(n){t=e}return t}},{key:"getPluginName",value:function(e){if(null==this.manifestJson)return null;var t=Object.keys(this.manifestJson.packages);for(var n in t){var o=t[n],i=this.manifestJson.packages[o].display_name;if(i==e)return o}}},{key:"getInstallerPath",value:function(){if(null==this.manifestJson)return null;try{var e=this.manifestJson.packages.SDKBOX.versions,t=null;for(var n in e){t=e[n],t=$.extend({},t);break}return null==t?null:(t.bundle=this.serverUrl+t.bundle,t)}catch(e){return null}}},{key:"fetchManifest",value:function(e){var t=this;this.fetchJson(this.serverUrl+"manifest.json",function(n,o){t.addCategoryInfo(n),t.addDescptionInfo(n),e(n,o)})}},{key:"fetchPackage",value:function(e,t,n){var o=this;this.fetchManifest(function(i,a){if(null==i)return void n(null,"fetch manifest failed");var r=o.getDownloadPath(e,t);o.fetchData(r,n)})}},{key:"fetchJson",value:function(e,t){if(null!=this.manifestJson)return void t(this.manifestJson,null);var n=this;this.fetchUrl(e,function(e){"string"==typeof e?t(null,e):e instanceof Response?e.ok?e.json().then(function(e){n.manifestJson=e,t(n.manifestJson,null)}):t(null,"failed, status: "+e.status):t(null,"unknow res type")})}},{key:"fetchData",value:function(e,t){return null==e?void t(null,"failed, url is null"):void this.fetchUrl(e,function(e){"string"==typeof e?t(null,e):e instanceof Response?e.ok?t(e,null):t(null,"failed, status: "+e.status):t(null,"unknow res type")})}},{key:"fetchUrl",value:function(e,t){fetch(e).then(function(e){t(e)},function(e){t(e.message)})}},{key:"getInstalledPlugins",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return!n&&e in this.projects&&this.projects[e]?void(t&&t(this.projects[e],null)):void this.queryInstalledPlugins(e,t)}},{key:"queryInstalledPlugins",value:function(t,n){var o=this;if(!c.isFile(r.join(t,".sdkbox_packages.json")))return console.log("project not include sdkbox packages"),this.projects[t]=this.projects[t]||{},void(n&&n(this.projects[t]));var i="sdkbox info "+t,a=s.getInstance();if(!a.query(i)){var l=[this.sdkbox_path,"--alwaysupdate","--local","--jsonapi","info"],u=this.projs.get(t),d=u.getSelectXcodeProject();u.isXcodeProjectEnable()&&d&&(l.push("--projectpath"),l.push(d)),d=u.getSelectAndroidProject(),u.isAndroidProjectEnable()&&d&&(l.push("--projectpath"),l.push(d));var h={tag:i,cwd:t};a.exec(l,h,function(i,a,r){var s=null,l=null;try{i?l=e.toString():(null!=a&&0!=a.length||(a="{}"),s=JSON.parse(a))}catch(e){l=e.toString()}l||(o.projects[t]=s),n&&n(s,l);for(var c in o._installedPluginsObserver)o._installedPluginsObserver[c]&&o._installedPluginsObserver[c](s,t)})}}},{key:"observeInstalledPlugin",value:function(e){this._installedPluginsObserver||(this._installedPluginsObserver={}),this._installedPluginsObserver[""+this.observerTagPrefix+this.observerTagCounter]=e,this.observerTagCounter++}},{key:"getDependency",value:function(e){if(Array.isArray(e)){var t=[];for(var n in e){var o=e[n],i=this.getDependency(o);i&&(t=t.concat(i))}return t}if(this.manifestJson){var a=e,r=null;try{r=this.manifestJson.packages[a].dependence}catch(e){console.log(e),r=null}return r&&0==r.length&&(r=null),r}}},{key:"addCategoryInfo",value:function(e){if(e)for(var t in e.packages){var n=e.packages[t];if(!n.category){var o=d[t]?d[t]:"MORE";n.category=o}}}},{key:"addDescptionInfo",value:function(e){if(e)for(var t in e.packages){var n=e.packages[t];if(!n.description){var o=h[t]?h[t]:"SDKBox Plugin:"+t;n.description=o}}}},{key:"getPluginPath",value:function(e){if(null==this.manifestJson)return null;e=e.toLowerCase();try{var t=this.manifestJson.packages[e].versions,n=null;for(var o in t){n=t[o].v3,n=$.extend({},n);break}if(null==n)return null;var i=n.bundle.slice(0,-7);return l.getSdkboxPluginsPath(i)}catch(e){return null}}},{key:"getXcodeProject",value:function(e){if(null==this.projs)return null;var t=null;try{t=this.projs.get(e).getSelectXcodeProject()}catch(e){console.log(e)}return t}},{key:"getProjectByPath",value:function(e){if(null==this.projs)return null;var t=null;try{t=this.projs.get(e)}catch(e){console.log(e)}return t}}]),t}()},118:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=n(4),s=n(119),l=n(114),c=n(120).queryParams(),u=void 0;e.exports=function(){function e(){o(this,e),this._process=new Map}return a(e,null,[{key:"getInstance",value:function(){return u||(u=new e,u.builtinCocosRoot=c.builtinCocosRoot),u}}]),a(e,[{key:"exec",value:function(e,t,n){this._nextId++;var o=e.shift(),a=t.tag;if(delete t.tag,this.builtinCocosRoot){var c=r.join(this.builtinCocosRoot,"tools","cocos2d-console","bin");t.env={PATH:s.env.PATH,COCOS_CONSOLE_ROOT:c}}var u=l.spawn(o,e,t);console.log("[CLI] spawn ("+u.pid+"): "+o+" "+e.join(" "));var d=this._process;d.set(a,u);var h=[],f=[];u.stdout.on("data",function(e){h.push(e),"object"===("undefined"==typeof n?"undefined":i(n))&&n.stdout(e)}),u.stderr.on("data",function(e){f.push(e),"object"===("undefined"==typeof n?"undefined":i(n))&&n.stderr(e)}),u.on("error",function(e){d.has(a)&&d.delete(a),"object"===("undefined"==typeof n?"undefined":i(n))?n.error(e,h.join(""),f.join("")):"function"==typeof n&&n(e,h.join(""),f.join(""))}),u.on("exit",function(e,t){t=t?t:"",console.log("[CLI] exit ("+u.pid+") "+e+" "+t),d.has(a)&&d.delete(a),"object"===("undefined"==typeof n?"undefined":i(n))?n.exit(h.join(""),f.join("")):"function"==typeof n&&n(null,h.join(""),f.join(""))})}},{key:"kill",value:function(e){if(this._process.has(e)){var t=this._process[e];t&&t.kill(),this._process.delete(e)}}},{key:"query",value:function(e){return this._process.has(e)}}]),e}()},119:function(e,t){e.exports=require("process")},120:function(e,t,n){"use strict";function o(e){return e&&e.__esModule?e:{default:e}}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var a=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),r=n(5),s=o(r),l=n(3),c=n(87),u=n(4);e.exports=function(){function e(){i(this,e)}return a(e,null,[{key:"arrayUnique",value:function(e){for(var t=0;t<e.length;++t)for(var n=t+1;n<e.length;++n)e[t]===e[n]&&e.splice(n--,1);return e}},{key:"queryParams",value:function(){var e={};if("undefined"==typeof window)return"";for(var t=window.location.search.substring(1),n=t.split("&"),o=0;o<n.length;o++){var i=n[o].split("=");if("undefined"==typeof e[i[0]])e[i[0]]=decodeURIComponent(i[1]);else if("string"==typeof e[i[0]]){var a=[e[i[0]],decodeURIComponent(i[1])];e[i[0]]=a}else e[i[0]].push(decodeURIComponent(i[1]))}return e}},{key:"isFile",value:function(e){var t=null;try{t=s.default.statSync(e)}catch(e){t=null}return!!t&&t.isFile()}},{key:"isDir",value:function(e){var t=null;try{t=s.default.statSync(e)}catch(e){t=null}return!!t&&t.isDirectory()}},{key:"exist",value:function(e){var t=null;try{t=s.default.statSync(e)}catch(e){t=null}return!!t}},{key:"makedir",value:function(e){var t=null;try{t=s.default.statSync(e)}catch(e){t=null}t&&!t.isDirectory()||c.sync(e)}},{key:"copy",value:function(t,n){e.makedir(n);var o=u.join(n,u.basename(t));s.default.createReadStream(t).pipe(s.default.createWriteStream(o))}},{key:"getSdkboxBinPath",value:function(){var e=u.join(l.homedir(),".sdkbox","bin","sdkbox");return"win32"==l.platform()?e+".bat":e}},{key:"isSdkboxInstalled",value:function(){var e=u.join(l.homedir(),".sdkbox","bin","sdkbox"),t=null;try{t=s.default.statSync(e)}catch(e){t=null}return!!t&&t.isFile()}}]),e}()},121:function(e,t,n){"use strict";function o(e){var t=c.join(l.homedir(),".sdkbox","bin","sdkbox"),n=null;try{n=u.statSync(t)}catch(e){n=null}return!!n&&n.isFile()}function i(){o()||s()}function a(){var e=c.join(l.homedir(),".sdkbox","bin","sdkbox");return e?"win32"==l.platform()?e+".bat":e:void d.showErrorBox("SDKBox installer not found","can't found installer at ~/.sdkbox/bin")}function r(e){var t=c.join(l.homedir(),".sdkbox","plugins");return e?c.join(t,e):t}function s(){var e=h.getInstance(),t="install sdkbox";if(!e.query(t)){var n=f.getInstance();n.open(),n.disableClose(),n.clear(),n.log("Prepare to install SDKBox Installer, please wait...");var o=["python","-c","import urllib; s = urllib.urlopen('https://raw.githubusercontent.com/sdkbox-doc/en/master/install/install.py').read(); exec s"];e.exec(o,{tag:t},{stdout:function(e){n.log(e.toString())},stderr:function(e){n.log(e.toString())},exit:function(e,t){n.enableClose()},error:function(e,t,o){n.log(e.toString());var i="\n\nInstall SDKBox installer failed.\nPlease tell us at (http://www.sdkbox.com/answers/)";n.log(i)}})}}var l=n(3),c=n(4),u=n(5),d=(n(119),n(116).remote.dialog),h=n(118),f=n(122);t.installIf=i,t.getSdkboxBinPath=a,t.getSdkboxPluginsPath=r,t.isInstalled=o},122:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();n(123);var a=void 0;e.exports=function(){function e(){var t=this;o(this,e),this._enableClose=!1,this._dialog=getConsoleOutputDialog(),this._dialog.on("dialogbeforeclose",function(e,n){return t._enableClose}),this._output=this._dialog.find(".output"),this._buttonsHtml=this._dialog.parent().find(".ui-dialog-buttonset button"),this.disableClose()}return i(e,null,[{key:"getInstance",value:function(){return a||(a=new e),a}}]),i(e,[{key:"open",value:function(){this._dialog.dialog("open"),this._dialog.dialog("moveToTop")}},{key:"close",value:function(){this._dialog.dialog("close")}},{key:"enableClose",value:function(){this._enableClose=!0,this._buttonsHtml.button("enable")}},{key:"disableClose",value:function(){this._enableClose=!1,this._buttonsHtml.button("disable")}},{key:"log",value:function(e){var t=$("<div>").html(e.autoLink());this._output.append(t),this._output.append("\n")}},{key:"clear",value:function(){this._output.empty()}}]),e}()},123:function(e,t){"use strict";(function(){var e=[].slice;String.prototype.autoLink=function(){var t,n,o,i,a,r;return i=1<=arguments.length?e.call(arguments,0):[],a=/(^|[\s\n]|<[A-Za-z]*\/?>)((?:https?|ftp):\/\/[\-A-Z0-9+\u0026\u2019@#\/%?=()~_|!:,.;]*[\-A-Z0-9+\u0026@#\/%=~()_|])/gi,0<i.length?(o=i[0],n=function(){var e;e=[];for(t in o)r=o[t],"callback"!==t&&e.push(" "+t+"='"+r+"'");return e}().join(""),this.replace(a,function(e,t,i){return e=("function"==typeof o.callback?o.callback(i):void 0)||"<a href='"+i+"'"+n+">"+i+"</a>",""+t+e})):this.replace(a,"$1<a href='$2'>$2</a>")}}).call(void 0)},124:function(e,t){"use strict";function n(e){o.find("div.tab-contents").addClass("hidden"),o.find("div#tab-"+e).removeClass("hidden"),o.find("div#tab-"+e).focus(),i.removeClass("selected"),$("#tabbar li[tag="+e+"]").addClass("selected")}var o=$("#contents"),i=$("#tabbar li");i.each(function(e,t){$(t).on("click",function(e){var t=$(e.target);t.hasClass("selected")||n(t.attr("tag"))})}),t.select_tab=n},125:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=n(5),r=n(3),s=n(116),l=n(116).ipcRenderer,c=n(116).remote,u=c.BrowserWindow,d=c.dialog,h=n(4),f=n(121),p=n(118),g=n(126),v=(n(127),n(129)),m=n(130),b=(n(122),n(132),n(133)),y=n(117),_=n(134),k=n(120),j=n(120).queryParams(),w=5;e.exports=function(){function e(){var t=this;o(this,e),this.sdkbox_path=f.getSdkboxBinPath(),this._configs={};this._addCurProjectIf(),this._listHtml=$("#tab-cocos .projects-list ul"),this._projectHtmlTpl=this._listHtml.find("li.template");var n=$("#tab-cocos .projects-details");this._detailsPlaceholderHtml=n.find(".placeholder"),this._detailsPlaceholderHtml.show(),this._detailsWrapperHtml=n.find(".details"),this._detailsWrapperHtml.hide(),this._detailsHtml={},this._detailsHtml.name={icon:n.find(".name .icon img"),title:n.find(".name h2")};var i=n.find(".basics");this._detailsHtml.basics={location:i.find(".location span"),xcodeProjectPath:i.find(".xcode-project-path select"),androidProjectPath:i.find(".android-project-path select"),xcodeProjectCheckBox:i.find(".xcode-project-path input"),androidProjectCheckBox:i.find(".android-project-path input"),engine:i.find(".engine span"),buildHint:n.find(".build-hint")},this._detailsHtml.basics.xcodeProjectPath.change(function(e){t.curPoject.setSelectXcodeProject($(e.target).children("option:selected").val())}),this._detailsHtml.basics.androidProjectPath.change(function(e){t.curPoject.setSelectAndroidProject($(e.target).children("option:selected").val())}),this._detailsHtml.basics.xcodeProjectCheckBox.change(function(e){var n=t._detailsHtml.basics.xcodeProjectCheckBox.is(":checked");t.curPoject.setXcodeProjectEnable(n)}),this._detailsHtml.basics.androidProjectCheckBox.change(function(e){var n=t._detailsHtml.basics.androidProjectCheckBox.is(":checked");t.curPoject.setAndroidProjectEnable(n)}),this._detailsHtml.live={blocks:n.find(".live"),tbody:n.find(".live.block tbody")},this._detailsHtml.plugins={tbody:n.find(".plugins.block tbody")},$("button.import").on("click",function(){t._onImportClick()}),$(".forStandalone").hide(),n.find("button.build-project").on("click",function(){t._onBuildProjectClick()}),this._buttons={import:n.find("button.import-plugin"),update:n.find("button.update-all-plugins"),open:n.find("button.open-project-folder"),build:n.find("button.build-project")},n.find("button.open-project-folder").on("click",function(){t._onOpenProjectFolderClick()}),n.find("button.remove-project").on("click",function(){t._onRemoveProjectClick()}),n.find("button.import-plugin").on("click",function(){return t.curPoject.isAndroidProjectEnable()||t.curPoject.isXcodeProjectEnable()?void t._onImportPluginClick():void alert("Anroid and Xcode project both is disable")}),n.find("button.update-all-plugins").on("click",function(){return t.curPoject.isAndroidProjectEnable()||t.curPoject.isXcodeProjectEnable()?void t._onUpdateAllPluginsClick():void alert("Anroid and Xcode project both is disable")});var a=$("#tab-cocos .tab-cocos-staging-flag");a.change(function(){a.is(":checked")?y.getInstance().changeServer("staging"):y.getInstance().changeServer("production")}),this._projects=new g(v),y.getInstance().projs=this._projects,this._loaders=new Map,this._importPluginsDialog=new m,this._importPluginsDialog.load(),y.getInstance().observeInstalledPlugin(function(e,n){t.observerInstalledPlugin(e,n)}),Array.isArray(this._configs.cocosProjects)&&this._configs.cocosProjects.forEach(function(e){t._addProject(e,!0)}),l.on("SDKBox:build-finish",function(){t._configs.cocosProjects=[],t._addCurProjectIf(),t._listHtml.empty(),t._projects.clear(),Array.isArray(t._configs.cocosProjects)&&t._configs.cocosProjects.forEach(function(e){t._addProject(e,!0)}),t._detailsPlaceholderHtml.show(),t._detailsWrapperHtml.hide(),t._showFirstProjectDetail()}),f.installIf(),this._showFirstProjectDetail()}return i(e,[{key:"_showBuildHint",value:function(e){e?this._detailsHtml.basics.buildHint.show():this._detailsHtml.basics.buildHint.hide()}},{key:"_addCurProjectIf",value:function(){var e=this._findProjects(j.project);for(var t in e)this._addProjectIf(e[t]);if(null==this._configs.cocosProjects||0==this._configs.cocosProjects.length){var n=h.basename(j.project);this._addProjectIf({projectName:n,projectPath:j.project})}}},{key:"_addProjectIf",value:function(e){this._configs.cocosProjects=this._configs.cocosProjects||[];var t=this._configs.cocosProjects.indexOf(e);0!=t&&(t>0&&this._configs.cocosProjects.removeAt(t),this._configs.cocosProjects.unshift(e))}},{key:"_findProjects",value:function(e){var t=h.basename(e),n=[],o=h.join(e,"local","builder.json"),i="./build";a.existsSync(o)&&(i=JSON.parse(a.readFileSync(o,"utf8")).buildPath),"win32"==r.platform()?i.length>2&&":"==i[1]||(i=h.join(e,i)):i.startsWith("/")||(i=h.join(e,i));var s=i,l=h.join(s,"jsb-default");return k.isDir(l)&&n.push({projectName:t,projectPath:l}),l=h.join(s,"jsb-link"),k.isDir(l)&&n.push({projectName:t,projectPath:l}),l=h.join(s,"jsb-binary"),k.isDir(l)&&n.push({projectName:t,projectPath:l}),n}},{key:"_onImportClick",value:function(){var e=this;l.send("open-file-dialog"),l.once("selected-directory",function(t,n){if(n)try{n=n[0],e._addProject(n)}catch(e){d.showErrorBox("Import Project Failed",e.toString())}})}},{key:"_onBuildProjectClick",value:function(){l.send("builder:open")}},{key:"_onOpenProjectFolderClick",value:function(){var e=this._detailsHtml.basics.location.text(),t=this._projects.get(e);s.shell.showItemInFolder(t.path),s.shell.beep()}},{key:"_onRemoveProjectClick",value:function(){var e=this,t={type:"question",buttons:["No","Yes"],defaultId:0,title:"Are you sure remove selected project ?",message:"Are you sure remove selected project ?",detail:"Project folder and files will not be deleted.",cancelId:0};d.showMessageBox(t,function(t){if(1==t){var n=e._detailsHtml.basics.location.text(),o=p.getInstance();o.kill("sdkbox info "+n),o.kill("sdkbox list "+n),o.kill("sdkbox import "+n),e._listHtml.find("> li").each(function(e,t){$(t).attr("path")===n&&$(t).remove()}),e._projects.remove(n),e._detailsPlaceholderHtml.show(),e._detailsWrapperHtml.hide();var i=e._configs.cocosProjects.indexOf(n);i>-1?(e._configs.cocosProjects.splice(i,1),_.getInstance().save(e._configs)):console.log("remove project, can't find "+n)}})}},{key:"_onImportPluginClick",value:function(){var e=this,t=this._detailsHtml.basics.location.text(),n=this._projects.get(t);this._importPluginsDialog.open(n,function(){e._queryProjectSdkboxInfo(n,!0)})}},{key:"_onUpdateAllPluginsClick",value:function(){var e=this,t=this._detailsHtml.basics.location.text(),n=this._projects.get(t);if(0==n.plugins.length){var o={type:"question",buttons:["OK"],defaultId:0,title:"Warning",message:"No SDKBox plugin installed! Needn't update.",cancelId:1};d.showMessageBox(u.getFocusedWindow(),o,function(e){})}else{var i={type:"question",buttons:["Update","Cancel"],defaultId:0,title:"Confirm update all installed plugins",message:"Confirm update all installed plugins:",detail:n.path,cancelId:1};d.showMessageBox(u.getFocusedWindow(),i,function(t){0===t&&e._updateAllPlugins(n)})}}},{key:"_showLoader",value:function(e){if(this._loaders.has(e.path))return!1;var t=this._queryItem(e);return t&&t.find(".loader").show(),this._loaders.set(e.path,!0),!0}},{key:"_hideLoader",value:function(e){if(!this._loaders.has(e.path))return!1;var t=this._queryItem(e);return t&&t.find(".loader").hide(),this._loaders.delete(e.path),!0}},{key:"_showFirstProjectDetail",value:function(){var e=this._projects.first();this.curPoject=e,this._showProjectDetail(e,this._queryItem(e))}},{key:"_showProjectDetail",value:function(e,t){e&&t&&(this._listHtml.find("> li").removeClass("selected"),t.addClass("selected"),this._updateDetails(e,!0),this._detailsPlaceholderHtml.hide(),this._detailsWrapperHtml.show(),this._queryProjectSdkboxInfo(e))}},{key:"_addProject",value:function(e,t){var n=this,o=null;try{o=this._projects.add(e)}catch(e){return}var i=this._projectHtmlTpl.clone();if(i.attr("path",o.path),i.find(".loader").hide(),i.removeClass("template"),i.on("click",function(){n.curPoject=o,n._showProjectDetail(o,i)}),this._listHtml.append(i),this._updateItem(o),this._queryProjectSdkboxInfo(o),!t){Array.isArray(this._configs.cocosProjects)||(this._configs.cocosProjects=[]);var a=this._configs.cocosProjects;a.push(e);for(var r=a.length,s=new Map,l=r-1;l>=0;l--)s.has(a[l])?a.splice(l,1):s.set(a[l],!0);_.getInstance().save(this._configs)}}},{key:"_queryItem",value:function(e){if(!e)return null;for(var t=this._listHtml.find("> li"),n=0;n<t.length;n++){var o=$(t[n]);if(o.attr("path")==e.path)return o}return null}},{key:"_updateItem",value:function(e){var t=this._queryItem(e);if(t){var n=t.find(".icon img");n.attr("src","../assets/img/cocos-project-icon.png"),t.find(".name h2").text(e.name),e.live&&t.find(".tags").append("<span>Live</span>");var o=t.find(".plugins-tags");o.empty(),$.each(e.plugins,function(e,t){o.append("<span>"+t.name+"</span>")})}}},{key:"_updateDetails",value:function(e,t){var n=this._detailsHtml;if(t||n.basics.location.text()===e.path){n.name.icon.attr("src","../assets/img/cocos-project-icon.png"),n.name.title.text(e.name),n.basics.location.text(e.path),n.basics.xcodeProjectPath.empty(),e.getXcodeProjects().forEach(function(e){n.basics.xcodeProjectPath.append('<option value ="'+h.basename(e)+'">'+e+"</option>")}),n.basics.xcodeProjectPath.children("option:eq("+e.getSelectXcodeProject()+")").prop("selected",!0),n.basics.androidProjectPath.empty(),e.getAndroidProjects().forEach(function(e){n.basics.androidProjectPath.append('<option value ="'+h.basename(e)+'">'+e+"</option>")}),n.basics.androidProjectPath.children("option:eq("+e.getSelectAndroidProject()+")").prop("selected",!0),n.basics.engine.text(e.engine),e instanceof v&&null==e.template?(n.basics.buildHint.show(),this._buttons.import.attr("disabled",!0).addClass("ui-state-disabled"),this._buttons.update.attr("disabled",!0).addClass("ui-state-disabled")):(n.basics.buildHint.hide(),this._buttons.import.attr("disabled",!1).removeClass("ui-state-disabled"),this._buttons.update.attr("disabled",!1).removeClass("ui-state-disabled")),e.live?n.live.blocks.show():n.live.blocks.hide();var o=n.plugins.tbody;o.empty(),Array.isArray(e.plugins)&&$(e.plugins).each(function(e,t){var n=y.getInstance().getDisplayName(t.name.toString());n=n?n:t.name.toString();var i="</td><td>-</td></tr>";if("googleplayservices"!=t.name.toString()){var a=t.name.toString();"gpg"==a&&(a="googleplay"),i='</td><td><a href="http://docs.sdkbox.com/en/plugins/'+a+'">Doc</a></td></tr>'}o.append("<tr><td>"+n+"</td><td>"+t.version.toString()+i)})}}},{key:"_queryProjectSdkboxInfo",value:function(e,t){var n=this;this._showLoader(e),y.getInstance().getInstalledPlugins(e.path,function(t,o){o?d.showErrorBox("Query SDKBOX Info Failed",o):e.updatePluginsFromJSON(t),n._hideLoader(e),n._updateItem(e),n._updateDetails(e),e._lastQuery=Date.now()})}},{key:"observerInstalledPlugin",value:function(e,t){if(this._projects){var n=this._projects.get(t);if(n&&!(Date.now()-n._lastQuery<1e3*w)&&e){var o=this._detailsHtml.basics.location.text();o===t&&(this._queryProjectSdkboxInfo(n),n._lastQuery=Date.now())}}}},{key:"_updateAllPlugins",value:function(e){var t=[];Array.isArray(e.plugins)&&$(e.plugins).each(function(e,n){t.push(n.name.toString())});var n=new b({creator_project_root:j.project,plugins:t,project:e.path,cmd:"update",installedPlugins:t});n.show()}}]),e}()},126:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=n(17);e.exports=function(){function e(t){o(this,e),this._items=new Map,this._projectClass=t}return i(e,[{key:"add",value:function(e){var t=new this._projectClass(e);if(!t.validate())throw new Error('This is path "'+e+'" is not project');if(this._items.has(t.path))throw new Error('This path "'+e+'" already imported');return this._items.set(t.path,t),t}},{key:"remove",value:function(e){a(this._items.has(e)),this._items.delete(e)}},{key:"get",value:function(e){return a(this._items.has(e)),this._items.get(e)}},{key:"first",value:function(){return this._items.values().next().value}},{key:"clear",value:function(){this._items.clear()}},{key:"count",value:function(){return this._items.size}}]),e}()},127:function(e,t,n){"use strict";function o(e,t){
if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=n(3),l="win32"===s.platform()?"\\":"/",c=n(5),u=(n(114),n(128));e.exports=function(e){function t(e){o(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"cocos"));return n._live=!1,n._plugins=[],n}return a(t,e),r(t,[{key:"validate",value:function(){var e=this._path+l+".cocos-project.json";try{var t=JSON.parse(c.readFileSync(e));this._engine=t.engine_version}catch(e){return console.log("CocosProject.validate() failed: "+e.toString()),!1}return!0}},{key:"updatePluginsFromJSON",value:function(e){var t=[];for(var n in e){var o=e[n],i={name:o.name,version:o.version.join(".")};t.push(i)}this._plugins=t.sort(function(e,t){return e.name<t.name?-1:e.name>t.name?1:0})}},{key:"live",get:function(){return this._live}},{key:"plugins",get:function(){return this._plugins}}]),t}(u)},128:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=n(3),r="win32"===a.platform()?"\\":"/";e.exports=function(){function e(t,n){o(this,e);var i=null;if("string"==typeof t){t=t.toString();var a=t.charAt(t.length-1);"/"!==a&&"\\"!==a||(t=t.substring(0,t.length-2)),i=t.substring(t.lastIndexOf(r)+1)}else i=t.projectName,t=t.projectPath;this._name=i,this._path=t,this._engine=n,this._icon=""}return i(e,[{key:"validate",value:function(){return!1}},{key:"name",get:function(){return this._name}},{key:"path",get:function(){return this._path}},{key:"engine",get:function(){return this._engine}},{key:"icon",get:function(){return this._icon}}]),e}()},129:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}var r=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),s=n(3),l="win32"===s.platform()?"\\":"/",c=n(5),u=n(4),d=(n(114),n(120)),h=n(128);e.exports=function(e){function t(e){o(this,t);var n=i(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,"creator"));return n._live=!1,n._plugins=[],n._template=null,n}return a(t,e),r(t,[{key:"validate",value:function(){var e=this._path+l+".cocos-project.json";d.isFile(e)?(this._template=u.basename(this._path),console.log("creator template:",this._template)):e=this._path+l+"project.json";try{var t=JSON.parse(c.readFileSync(e));this._engine=t.engine}catch(e){return console.log("CreatorProject.validate() failed: "+e.toString()),!1}return this._xcodeProjectEnable=!0,this._androidProjectEnable=!0,this.getXcodeProjects(),this.getAndroidProjects(),!0}},{key:"updatePluginsFromJSON",value:function(e){var t=[];for(var n in e){var o=e[n],i={name:o.name,version:o.version.join(".")};t.push(i)}this._plugins=t.sort(function(e,t){return e.name<t.name?-1:e.name>t.name?1:0})}},{key:"findFile",value:function(e){c.readFileSync(e).forEach(function(e){c.i})}},{key:"searchFile",value:function(e,t){var n=[],o=function e(o){var i=[];try{i=c.readdirSync(o)}catch(e){i=[]}i.forEach(function(i){var a=0,r=u.join(o,i);if(t&&(a=t(r)),1==a)n.push(r);else if(2==a);else{var s=c.statSync(r);s.isDirectory()&&e(r)}})};return o(e),n}},{key:"getXcodeProjects",value:function(){var e=this,t=u.join(this._path,"frameworks","runtime-src","proj.ios_mac"),n=this.searchFile(t,function(e){return e.endsWith(".xcodeproj")?1:e.endsWith(".framework")||e.endsWith(".xcassets")?2:0}),o=!1,i=[];return n.forEach(function(n){var a=u.relative(u.dirname(t),n);i.push(a),a==e._xcodeproj&&(o=!0)}),i.sort(function(e,t){return e.includes("backup")?1:t.includes("backup")?-1:0}),o||(this._xcodeproj=i[0]),i}},{key:"setSelectXcodeProject",value:function(e){this._xcodeproj=e}},{key:"getSelectXcodeProject",value:function(){return this._xcodeproj}},{key:"setXcodeProjectEnable",value:function(e){this._xcodeProjectEnable=e}},{key:"isXcodeProjectEnable",value:function(){return this._xcodeProjectEnable}},{key:"getAndroidProjects",value:function(){var e=this,t=u.join(this._path,"frameworks","runtime-src"),n=this.searchFile(t,function(e){return e.includes("proj.android")?1:2}),o=!1,i=[];return n.forEach(function(n){var a=u.relative(t,n);i.push(a),a==e._androidproj&&(o=!0)}),i.sort(function(e,t){return e.includes("backup")?1:t.includes("backup")?-1:0}),o||(this._androidproj=i[0]),i}},{key:"setSelectAndroidProject",value:function(e){this._androidproj=e}},{key:"getSelectAndroidProject",value:function(){return this._androidproj}},{key:"setAndroidProjectEnable",value:function(e){this._androidProjectEnable=e}},{key:"isAndroidProjectEnable",value:function(){return this._androidProjectEnable}},{key:"live",get:function(){return this._live}},{key:"plugins",get:function(){return this._plugins}},{key:"template",get:function(){return this._template}}]),t}(h)},130:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=n(116).remote.dialog,r=n(116).remote.BrowserWindow,s=n(121),l=n(122),c=n(131),u=(n(132),n(133)),d=n(117),h=["ESSENTIALS","ANALYTICS","IAP OPTIMIZATION","APP STORES","AD UNITS","SOCIAL","ATTRIBUTION","PUSH NOTIFICATION","MORE"],f=function(){function e(){o(this,e),this.plugins={},this._lastLoad=0,this.sdkbox_path=s.getSdkboxBinPath()}return i(e,[{key:"load",value:function(e){var t=this;this._callback=e,d.getInstance().fetchManifest(function(e,n){t._onLoadCallback(n,e,null)})}},{key:"_onLoadCallback",value:function(e,t,n){var o=this;try{if(e)throw new Error(e.toString());var i=t.packages,r=[];Object.keys(i).forEach(function(e){if("SDKBOX"!=e){var t=i[e];if(!t.is_library){var n={name:e,display_name:t.display_name,category:t.category,description:t.description};Object.keys(t.versions).forEach(function(e){n.version=e}),r.push(n)}}}),this.plugins={},r.forEach(function(e){var t=o.plugins[e.category];t||(t=[]),t.push(e),o.plugins[e.category]=t}),this._lastLoad=Date.now(),"function"==typeof this._callback&&(this._callback(!0),this._callback=null)}catch(e){a.showErrorBox("Download Plugins List Failed",e.toString()),"function"==typeof this._callback&&(this._callback(!1),this._callback=null)}}}]),e}();e.exports=function(){function e(){var t=this;o(this,e),this._dialog=getImportCocosPluginsDialog(),this._dialog.on("dialogclose",function(){t._onClose()}),this._consoleDialog=l.getInstance(),this._queryInstallTapcoreDialog=new c,this._loaderHtml=this._dialog.find(".loader"),this._contentsHtml=this._dialog.find(".contents"),this._treeHtml=this._contentsHtml.find("> div"),this._treeComponentTpl=this._treeHtml.find(".tree-component"),this._list=new f,this.sdkbox_path=this._list.sdkbox_path}return i(e,[{key:"load",value:function(){s.isInstalled()&&this._list.load()}},{key:"open",value:function(e,t){var n=this;this._project=e,this._callback=t,this._loaderHtml.show(),this._contentsHtml.hide(),this._treeHtml.empty(),this._dialog.dialog("open"),this._list.load(function(t){t?n._updateTable(e):n._dialog.dialog("close")})}},{key:"_onClose",value:function(){this._project=null,this._callback=null}},{key:"_updateTable",value:function(e){this._loaderHtml.hide(),this._contentsHtml.show();var t=new Map;e.plugins.forEach(function(e){t.set(e.name,e)});var n=this._list.plugins,o=!0,i=!1,a=void 0;try{for(var r,s=h[Symbol.iterator]();!(o=(r=s.next()).done);o=!0){var l=r.value;n[l]&&this._treeHtml.append(this.genTreeComponent(l,n[l]))}}catch(e){i=!0,a=e}finally{try{!o&&s.return&&s.return()}finally{if(i)throw a}}this.registerEvent()}},{key:"genTreeComponent",value:function(e,t){var n=this._treeComponentTpl.clone();n.removeClass("hidden"),n.find(".tree-header-content").html(e);var o="tree-item-bg-",i=1;return t.forEach(function(e){var t=e.name.toString();"gpg"==t&&(t="googleplay");var a='\n            <div class="tree-item '+(o+i)+'">\n                <span class="tree-item-content">\n                    <a href="http://docs.sdkbox.com/en/plugins/'+t+'">'+e.display_name+'</a>\n                    <span class="tree-item-content-tip">'+e.description+'</span>\n                </span>\n                <button class="tree-item-action">Import</button>\n            </div>\n            ';n.find(".tree-content").append($(a)),i+=1,i=i>2?1:i}),n}},{key:"registerEvent",value:function(){var e=this;this._treeHtml.find(".tree-header").on("click",function(){var e=$(this),t=e.parent(),n=t.find(".tree-content"),o=n.is(":visible")?"-90":"0";n.toggle(100),t.find(".tree-header-icon").css({transform:"rotate("+o+"deg)"})}),this._treeHtml.find(".tree-item-action").on("click",function(){var t=$(this),n=t.parent(),o=n.find(".tree-item-content>a").get(0).firstChild.nodeValue.trim();e._onImportClick(d.getInstance().getPluginName(o),o)})}},{key:"_onImportClick",value:function(e,t){var n=this,o=[];if(o.push(e),0===o.length)return void a.showErrorBox("Warning","Please select least one plugin");if("tapcore"==e)this._queryInstallTapcoreDialog.open(function(e){var t=n._callback,i=n._project;n._dialog.dialog("close"),n._callback=t,n._project=i,n._selected=o,n._importPlugin(e)});else{var i={type:"question",buttons:["Import","Cancel"],defaultId:0,title:"Confirm import selected plugins",message:"Confirm import selected plugins:",detail:t,cancelId:1};a.showMessageBox(r.getFocusedWindow(),i,function(e){if(0===e){var t=n._callback,i=n._project;n._dialog.dialog("close"),n._callback=t,n._project=i,n._selected=o,n._importPlugin()}})}}},{key:"_importFinish",value:function(){this._consoleDialog.enableClose();var e=this._callback;this._project=null,this._callback=null,e()}},{key:"_importPlugin",value:function(e){var t=this;d.getInstance().getInstalledPlugins(this._project.path,function(o,i){if(i)a.showErrorBox("Query SDKBOX Info Failed",i);else{var r=new u({creator_project_root:n(120).queryParams().project,plugins:t._selected,project:t._project.path,cmd:"import",installedPlugins:Object.keys(o),tapcore_token:e});r.show()}})}}]),e}()},131:function(e,t){"use strict";function n(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}();e.exports=function(){function e(){var t=this;n(this,e),this._dialog=getQueryInstallTapCoreDialog(),this._dialog.on("dialogclose",function(){t._onClose()}),this._dialog.wrapper=this}return o(e,[{key:"open",value:function(e){this._callback=e,this._dialog.dialog("open"),this._token=this._dialog.find(".tapcore-token")}},{key:"import",value:function(){var e=this._token.val();return"undefined"==typeof e||0==e.length?void alert("you must fill tapcore token before install tapcore"):(this._callback&&this._callback(e),void this._dialog.dialog("close"))}},{key:"_onClose",value:function(){this._callback=null}}]),e}()},132:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=n(116),r=a.ipcRenderer,s=void 0;e.exports=function(){function e(){var t=this;o(this,e),r.on("download-status",function(e,n){"interrupted"===n.state?(t._downloadFailList.push(t._downloadingPlugin),t.download()):"progressing"===n.state&&t.setProgress(n.downloadRatio)}),r.on("download-finish",function(e,n){delete t._dlUrl,"completed"===n.state?t._downloadSuccessList.push(t._downloadingPlugin):(t._downloadFailList.push(t._downloadingPlugin),console.log("download failed:"+n.state)),t.download()}),this._dialog=getDownloadDialog(),this._dialog.on("dialogbeforeclose",function(e,n){return t._dlUrl&&r.send("cancel-download-file",t._dlUrl),!0}),this._download_bar=this._dialog.parent().find(".download-progress .download-bar"),this._download_label=this._dialog.parent().find(".download-progress .download-bar .download-label")}return i(e,null,[{key:"getInstance",value:function(){return s||(s=new e),s}}]),i(e,[{key:"startDownload",value:function(e,t,n){var o=this;this._dlUrl=url,this._downloadList=e,this._downloadSuccessList=[],this._downloadFailList=[],this._pluginVersion=t,this._downloadingPlugin=null,this._callback=n,dataMgr.getInstance().fetchManifest(function(e,t){null!=e?(o.download(),o.show()):o._callback(null,t)})}},{key:"download",value:function(){return this._downloadingPlugin=this._downloadList.shift(),this._downloadingPlugin?(this._dlUrl=dataMgr.getInstance().getDownloadPath(this._downloadingPlugin,this._pluginVersion),void(this._dlUrl?r.send("download-file",this._dlUrl):(this._downloadFailList.push(this._downloadingPlugin),this.download()))):void(0==this._downloadFailList.size()?this._callback(this._downloadSuccessList,null):this._callback(this._downloadSuccessList,"not all plugin download success"))}},{key:"setProgress",value:function(e){this._download_bar.css("width",Math.floor(e)+"%"),this._download_label.html(e+"%")}},{key:"show",value:function(){this._dialog.dialog("open"),this._dialog.dialog("moveToTop")}},{key:"hiden",value:function(){this._dialog.dialog("close")}}]),e}()},133:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=n(120),r=n(3),s=n(4),l=n(5),c=n(116),u=c.ipcRenderer;n(116).remote.dialog;n(123);var d=n(118),h=n(117),f=n(121),p=void 0;e.exports=function(){function e(t){var n=this;o(this,e),this.options=t,"installer"in this.options&&(this.options.installer=!1),this.sdkbox_path=f.getSdkboxBinPath(),this._enableClose=!1,this._dialog||(this._dialog=getInstallSdkboxPluginsDialog(),this._dialog.on("dialogbeforeclose",function(e,t){return n._enableClose}),this._downloads=this._dialog.find(".download-plugin-list"),this._downloadItemTemplate=this._downloads.find(".download-plugin-item.hidden"),this._documents=this._dialog.find(".plugin-document-list"),this._documentItemTemplate=this._documents.find(".plugin-document-item.hidden"),this._cliOutput=this._dialog.find(".import-cli-output"),this._buttonCancel=this._dialog.parent().find(".ui-dialog-buttonset button"),this._downloadItemTemplate.detach(),this._documentItemTemplate.detach(),this.registerDownloadEvent()),this.clear(),h.getInstance().fetchManifest(function(e,t){t||(n.resetDownloadItems(n.options.plugins,n.options.installer),n.resetDialog(),n.enableClose(),n._buttonCancel.addClass("ui-state-active"),n.tryInstall(),n.downloadNext())})}return i(e,null,[{key:"getInstance",value:function(){return p||(p=new e),p}}]),i(e,[{key:"show",value:function(){this._dialog.dialog("open"),this._dialog.dialog("moveToTop")}},{key:"close",value:function(){this._dialog.dialog("close")}},{key:"enableClose",value:function(){this._enableClose=!0,this._buttonCancel.button("enable")}},{key:"disableClose",value:function(){this._enableClose=!1,this._buttonCancel.button("disable")}},{key:"clear",value:function(){this._buttonCancel.text("Cancel"),this._downloads.empty(),this._downloads.append(this._downloadItemTemplate),this._documents.empty(),this._documents.append(this._documentItemTemplate),this._cliOutput.empty()}},{key:"appendDependency",value:function(e){var t=h.getInstance().getDependency(e);return t=t.concat(e),t=a.arrayUnique(t)}},{key:"resetDownloadItems",value:function(e,t){var n=this.appendDependency(e),o=[];t&&o.push({name:"Installer",bundle:h.getInstance().getInstallerPath(),status:"pending"});for(var i in n){var a=n[i],r=h.getInstance().getDownloadPath(a,"v3");null!=r&&o.push({name:a,display_name:h.getInstance().getDisplayName(a),bundle:r,status:this.checkPluginValid(r)})}this._installItems=o}},{key:"checkPluginValid",value:function(e){var t=e.bundle.split("/").pop(),n=s.join(r.homedir(),".sdkbox","plugins",t);if(l.existsSync(n))return"ready";n=n.slice(0,-7);var o=null;try{o=l.statSync(n)}catch(e){o=null}return o&&o.isDirectory()?"ready":"pending"}},{key:"resetDialog",value:function(){for(var e in this._installItems){var t=this._installItems[e],n=this._downloadItemTemplate.clone();if(n.removeClass("hidden"),n.find(".download-plugin-name").html(t.display_name),n.find(".download-plugin-status").html(t.status),"ready"==t.status&&(n.find(".download-plugin-bar").css("width","100%"),n.find(".download-plugin-label").html("100%")),this._downloads.append(n),"installer"!==t.name.toLowerCase()&&"googleplayservices"!==t.name){var o=this._documentItemTemplate.clone();o.removeClass("hidden"),o.find(".plugin-document-item-name").html(t.display_name);var i=t.name.toLowerCase();o.find(".plugin-document-item-docs").attr("href","http://docs.sdkbox.com/en/plugins/"+i),o.find(".plugin-document-item-sample").attr("href","https://github.com/sdkbox/sdkbox-sample-"+i),this._documents.append(o)}}}},{key:"changeItemStatus",value:function(e,t,n){for(var o=this._downloads.children().length-1;o>=0;o--){var i=this._downloads.children().eq(o),a=i.find(".download-plugin-name").text();if(this.compareCaseInsensitive(e,a)){t&&(t<1&&(t=1),i.find(".download-plugin-bar").css("width",Math.floor(t)+"%"),i.find(".download-plugin-label").html(Math.floor(t)+"%")),n&&i.find(".download-plugin-status").html(n);break}}}},{key:"compareCaseInsensitive",value:function(e,t){return e.toLowerCase()===t.toLowerCase()}},{key:"showlog",value:function(e){this._cliOutput.append($("<div>").html(e))}},{key:"registerDownloadEvent",value:function(){var e=this;u.on("download-status",function(t,n){"interrupted"===n.state?(e.setDownloadItemStatus(n.url,null,"download failed"),e.downloadNext()):"progressing"===n.state&&e.setDownloadItemStatus(n.url,n.downloadRatio,"downloading")}),u.on("download-finish",function(t,n){delete e._dlUrl,"completed"===n.state?(e.setDownloadItemStatus(n.url,100,"downloading"),e.moveDownloadFile(n.url)):(e.setDownloadItemStatus(n.url,null,"download failed"),console.log("download failed:"+n.state),e.tryInstall()),e.downloadNext()})}},{key:"downloadNext",value:function(){var e=this.findFirstItem("pending");return e?void(e!=this._downloadingItem&&(this._downloadingItem=e,this.showlog("Begin download "+e.bundle.bundle),u.send("download-file",e.bundle.bundle))):void this.disableClose()}},{key:"findFirstItem",value:function(e){for(var t in this._installItems){var n=this._installItems[t];if(e==n.status)return n}}},{key:"setDownloadItemStatus",value:function(e,t,n){for(var o in this._installItems){var i=this._installItems[o];if(this.compareCaseInsensitive(e,i.bundle.bundle)||this.compareCaseInsensitive(e,i.name)){n&&(i.status=n),this.changeItemStatus(i.display_name,t,n);break}}}},{key:"moveDownloadFile",value:function(e){var t=this,n=e.split("/").pop(),o=s.join(r.homedir(),".sdkbox","temp",n),i=s.join(r.homedir(),".sdkbox","plugins",n);try{l.rename(o,i,function(){t.setDownloadItemStatus(e,null,"ready"),t.tryInstall()})}catch(t){this.setDownloadItemStatus(e,null,"download failed"),this.tryInstall()}}},{key:"tryInstall",value:function(){var e=this.findFirstItem("pending");e||(e=this.findFirstItem("downloading"),e||this.installNext())}},{key:"installNext",value:function(){var e=this.findFirstItem("ready");return e?(this.showlog("Begin install "+e.name),void this.installPlugin(e.name)):(this._buttonCancel.text("Finish"),this.enableClose(),h.getInstance().getInstalledPlugins(this.options.project,null,!0),void this.showlog("Install Finish"))}},{key:"installPlugin",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"import";if(null==this.options.project)return void this.showlog("Error! Project path is null");if(!this.sdkbox_path)return void this.showlog("Error! Can not find SDKBox installer");var o=d.getInstance(),i="sdkbox import "+this.options.project;if(!o.query(i)){this.setDownloadItemStatus(e,null,"installing");var a=[this.sdkbox_path,"--alwaysupdate","--nohelp","--runin","gui-creator","-s","main",n,e];e in this.options.installedPlugins&&(a.push("--forcecopy"),a.push("--nopatching")),h.getInstance().isStaging()&&a.push("--staging"),"tapcore"==e&&(a.push("--apitoken"),a.push(this.options.tapcore_token));var r=h.getInstance().getProjectByPath(this.options.project);if(r){if(!r.isXcodeProjectEnable()&&!r.isAndroidProjectEnable())return;var s=r.getSelectXcodeProject();r.isXcodeProjectEnable()&&s&&(a.push("--projectpath"),a.push(s)),s=r.getSelectAndroidProject(),r.isAndroidProjectEnable()&&s&&(a.push("--projectpath"),a.push(s))}var l={tag:i,cwd:this.options.project};this.showlog("> "+a.join(" ")),o.exec(a,l,{stdout:function(e){t.showlog(e.toString())},stderr:function(e){t.showlog(e.toString())},exit:function(o,i){t.setDownloadItemStatus(e,null,"success"),t.showlog(""),t.showlog("-----------------------------------"),t.showlog(""),t.installNext(),"import"==n&&t.installDTS(e)},error:function(n,o,i){t.setDownloadItemStatus(e,null,"install failed"),t.showlog(n.toString()),t.installNext()}})}}},{key:"installDTS",value:function(e){var t=h.getInstance().getPluginPath(e),n=s.join(t,"plugin","jsbindings");if(a.isDir(n))for(var o=l.readdirSync(n).filter(function(e){return e.endsWith(".d.ts")}),i=this.options.creator_project_root,r=o.length-1;r>=0;r--)a.copy(s.join(n,o[r]),s.join(i,"sdkbox","js","assist"))}}]),e}()},134:function(e,t,n){"use strict";function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}return function(t,n,o){return n&&e(t.prototype,n),o&&e(t,o),t}}(),a=n(3),r=n(5),s=n(4),l=n(87),c=void 0;e.exports=function(){function e(){o(this,e);var t=a.homedir();this._path=s.join(t,".sdkbox","conf","gui.json")}return i(e,null,[{key:"getInstance",value:function(){return c||(c=new e),c}}]),i(e,[{key:"load",value:function(){try{var e=r.readFileSync(this._path),t=JSON.parse(e);return t}catch(e){return console.log(e.toString()),null}}},{key:"save",value:function(e){var t=JSON.stringify(e),n=s.dirname(this._path),o=null;try{o=r.statSync(n)}catch(e){o=null}o&&!o.isDirectory()||l.sync(s.dirname(this._path)),r.writeFileSync(this._path,t)}}]),e}()},135:function(e,t){e.exports=require("url")}})});